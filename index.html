<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Poker Table Viewer</title>
  <style>
    :root {
      --bg: #0a0f1a;
      --panel: #020617;
      --panel-border: #1f2937;
      --accent: #22c55e;
      --text-main: #e5e7eb;
      --text-muted: #9ca3af;
      --btn: #2563eb;
      --btn-hover: #1d4ed8;
      --danger: #dc2626;
      --danger-hover: #b91c1c;
    }

    * { box-sizing: border-box; }

    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
      background: radial-gradient(circle at 25% 15%, #111827 0, #020617 35%, #05070e 70%),
        radial-gradient(circle at 80% 0%, #0b1324 0, #05070e 45%, #020617 80%),
        #01030a;
      color: var(--text-main);
      margin: 0;
      padding: 0;
      height: 100vh;
      display: flex;
      justify-content: center;
      align-items: stretch;
    }

    .layout {
      display: flex;
      flex-direction: column;
      gap: 12px;
      width: 100%;
      height: 100vh;
      max-width: none;
      padding: 12px;
    }

    .legal-footer {
      position: fixed;
      right: 12px;
      bottom: 12px;
      font-size: 11px;
      color: var(--text-muted);
      z-index: 2000;
    }

    .legal-footer a {
      color: inherit;
      text-decoration: none;
    }

    .legal-footer a:hover {
      color: var(--text-main);
      text-decoration: underline;
    }

    .panel {
      background: none;
      border-radius: 16px;
      border: none;
      box-shadow: none;
      padding: 0;
      display: flex;
      flex-direction: column;
      flex: 1;
      min-height: 0;
    }

    /* Hide the legacy control surface on the poker view; controls now live on the Club Management page. */
    .control-panel {
      display: none !important;
    }

    h1 { margin: 0 0 8px; font-size: 20px; }
    h2 {
      font-size: 14px;
      margin: 16px 0 8px;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.08em;
    }

    .row { margin-bottom: 10px; }

    button {
      margin: 4px 4px 4px 0;
      padding: 6px 12px;
      border-radius: 999px;
      border: none;
      cursor: pointer;
      background: var(--btn);
      color: white;
      font-size: 12px;
    }
    button:hover:not(:disabled) { background: var(--btn-hover); }
    button:disabled {
      background: #374151;
      cursor: default;
      color: #9ca3af;
    }

    .btn-danger {
      background: var(--danger);
    }
    .btn-danger:hover:not(:disabled) {
      background: var(--danger-hover);
    }



    input[type="text"],
    input[type="password"],
    input[type="number"] {
      width: 100%;
      max-width: 200px;
      padding: 4px 8px;
      border-radius: 999px;
      border: 1px solid #4b5563;
      background: #020617;
      color: #f9fafb;
      font-size: 12px;
      margin: 2px 0 6px;
    }

    select {
      padding: 4px 8px;
      border-radius: 999px;
      border: 1px solid #4b5563;
      background: #020617;
      color: #f9fafb;
      font-size: 12px;
    }

    .label {
      font-weight: 600;
      margin-right: 6px;
      font-size: 12px;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.08em;
    }

    .card-img {
      width: 70px;
      height: 100px;
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.6);
    }

    .seat-card img {
      width: 60px;
      height: 90px;
      border-radius: 6px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.5);
    }

    .hint {
      font-size: 11px;
      color: var(--text-muted);
    }

    .wallet-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
    }

    /* TABLE AREA */

    .table-wrapper {
      position: relative;
      width: 100%;
      flex: 0 1 auto;
      height: 100%;
      min-height: 320px;
      max-height: calc(100vh - 170px);
      background: radial-gradient(circle at 35% 20%, rgba(36, 68, 120, 0.35), transparent 45%),
        radial-gradient(circle at 70% 75%, rgba(8, 13, 26, 0.6), transparent 50%),
        #030712;
      border-radius: 24px;
      overflow: hidden;
      margin-bottom: 12px;
      box-shadow: inset 0 0 0 1px rgba(255, 255, 255, 0.02), 0 20px 50px rgba(0,0,0,0.65);
      perspective: 900px;
      perspective-origin: 50% 18%;
      transform: rotateX(10deg);
      transition: height 0.15s ease-out;
      z-index: 0;
    }

    .felt {
      position: absolute;
      inset: 5% 8%;
      overflow: hidden;
      border-radius: 50% / 38%;
      display: flex;
      justify-content: center;
      align-items: center;
      filter: drop-shadow(0 18px 30px rgba(0,0,0,0.55));
      transform: rotateX(-46deg) translateY(-14%) translateZ(30px) scale(1.08);
      transform-style: preserve-3d;
    }

    .felt::before {
      content: "";
      position: absolute;
      inset: -8%;
      background: radial-gradient(circle at 35% 25%, #29e375 0%, #058f4f 35%, #013322 68%, #001c14 90%);
      border-radius: 55% / 42%;
      transform: rotate(-8deg) scale(1.08);
      box-shadow:
        inset 0 0 0 14px rgba(2, 6, 23, 0.55),
        inset 0 0 0 22px rgba(0, 0, 0, 0.35);
    }

    .felt::after {
      content: "";
      position: absolute;
      inset: 6%;
      border-radius: 50% / 40%;
      background: radial-gradient(circle at 50% 60%, rgba(255,255,255,0.1), transparent 55%);
      mix-blend-mode: screen;
      pointer-events: none;
    }

    .felt-content {
      position: relative;
      width: 100%;
      height: 100%;
      transform: rotate(2deg) translateY(-12%) translateZ(50px);
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .felt-surface {
      position: absolute;
      inset: 8% 14%;
      border-radius: 50% / 45%;
      pointer-events: none;
      box-shadow:
        0 0 0 10px rgba(0, 0, 0, 0.25),
        inset 0 12px 30px rgba(0,0,0,0.5);
      background: radial-gradient(circle at 50% 55%, rgba(255,255,255,0.08), transparent 65%);
    }

    .center-area {
      position: relative;
      width: 52%;
      max-width: 480px;
      text-align: center;
      color: #ecfdf5;
      text-shadow: 0 6px 18px rgba(0,0,0,0.6);
      transform: translateY(-4%);
    }

    .board-cards { margin-bottom: 6px; }

    @keyframes deal-card {
      from {
        opacity: 0;
        transform: translateY(16px) scale(0.9);
      }
      to {
        opacity: 1;
        transform: translateY(0) scale(1);
      }
    }

    .card.dealt,
    .seat-card.dealt {
      animation: deal-card 0.3s ease-out;
    }

    .card {
      display: inline-block;
      padding: 6px 10px;
      margin: 0 3px;
      border-radius: 8px;
      background: rgba(15,23,42,0.9);
      border: 1px solid rgba(148,163,184,0.4);
      font-family: "Menlo", monospace;
      font-size: 14px;
      box-shadow: 0 6px 12px rgba(0,0,0,0.4);
    }

    .pot-info { font-size: 13px; margin-bottom: 4px; }
    .street-info { font-size: 12px; color: #cfebff; opacity: 0.8; }

    /* --- GG-style seat panel --- */

    .seat-inner {
      background: rgba(15, 23, 42, 0.96);
      border-radius: 16px;
      padding: 8px 10px;
      border: 2px solid rgba(15, 23, 42, 0.9);
      box-shadow: 0 8px 18px rgba(0, 0, 0, 0.8);
      transition: border-color 0.15s ease-out, box-shadow 0.15s ease-out;
    }

    .seat-main {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    /* Avatar bubble */
    .seat-avatar {
      width: 34px;
      height: 34px;
      border-radius: 999px;
      background: radial-gradient(circle at 30% 20%, #4f46e5, #0f172a);
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 0 0 2px rgba(15, 23, 42, 0.9), 0 4px 8px rgba(0,0,0,0.7);
      flex-shrink: 0;
    }

    .seat-avatar-initial {
      font-size: 16px;
      font-weight: 700;
      color: #e5e7eb;
    }

    /* Name + stack row */
    .seat-body {
      flex: 1;
    }

    .seat-name-row {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
    }

    .seat-name {
      font-size: 14px;
      font-weight: 700;
    }

    .seat-stack {
      font-size: 14px;
      font-weight: 700;
      color: #4ade80; /* bright green for chips */
    }

    /* Status + bet row */
    .seat-meta-row {
      margin-top: 2px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 6px;
    }

    .seat-status {
      font-size: 11px;
      color: #9ca3af;
    }

    .seat-bet {
      font-size: 11px;
      color: #facc15; /* yellow for current bet */
    }

    /* Bigger GG-style hole cards */
    .seat-cards {
      margin-top: 6px;
      display: flex;
      gap: 6px;
    }

    .seat-card img {
      width: 72px;
      height: 102px;
      border-radius: 10px;
      box-shadow: 0 6px 14px rgba(0,0,0,0.8);
    }

    /* Highlight acting player */
    .seat.highlight .seat-inner {
      border-color: #22c55e;
      box-shadow: 0 0 0 1px rgba(34,197,94,0.7), 0 10px 22px rgba(0,0,0,0.9);
    }

    /* Seats */

    .seat {
      position: absolute;
      width: 22%;
      max-width: 210px;
      transform: translate(-50%, -50%);
      color: #e5e7eb;
      z-index: 5;
      pointer-events: auto;
    }

    .seat-inner {
      background: linear-gradient(145deg, rgba(20, 29, 49, 0.95), rgba(10, 14, 26, 0.95));
      border-radius: 14px;
      padding: 8px 10px;
      border: 1px solid rgba(96, 165, 250, 0.12);
      font-size: 11px;
      box-shadow: 0 8px 18px rgba(0,0,0,0.65), inset 0 1px 0 rgba(255,255,255,0.04);
      backdrop-filter: blur(3px);
    }

    .seat-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 4px;
    }

    .seat-name { font-weight: 600; font-size: 12px; }
    .seat-stack { font-size: 12px; color: #bbf7d0; }
    .seat-status { font-size: 10px; color: var(--text-muted); margin-bottom: 4px; }

    .seat-cards {
      display: flex;
      gap: 4px;
      margin-bottom: 4px;
    }

    .seat-card {
      padding: 3px 6px;
      border-radius: 6px;
      background: #111827;
      border: 1px solid #4b5563;
      font-family: "Menlo", monospace;
      font-size: 11px;
    }

    .seat.empty .seat-inner {
      opacity: 0.2;
      border-style: dashed;
    }

    .seat.highlight .seat-inner {
      border-color: var(--accent);
      box-shadow: 0 0 0 1px rgba(34,197,94,0.6), 0 8px 16px rgba(0,0,0,0.8);
    }

    /* ACTION DOCK */

    .action-dock {
      margin-top: 8px;
      padding: 8px 10px;
      border-radius: 10px;
      background: #020617;
      border: 1px solid #1f2937;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
    }

    .action-left,
    .action-middle,
    .action-right {
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .action-left button {
      padding: 10px 20px;
      font-size: 14px;
      font-weight: 600;
    }

    .action-middle-main {
      display: flex;
      align-items: baseline;
      gap: 4px;
    }

    .bottom-label {
      font-size: 11px;
      color: var(--text-muted);
    }

    .action-right button {
      padding: 4px 8px;
      font-size: 11px;
    }

    .action-right input[type="number"] {
      width: 70px;
      padding: 2px 4px;
      border-radius: 999px;
      border: 1px solid #4b5563;
      background: #020617;
      color: #f9fafb;
      font-size: 11px;
    }

    /* Raw JSON */

    pre {
      background: #020617;
      padding: 8px;
      border-radius: 8px;
      overflow-x: auto;
      font-size: 11px;
      border: 1px solid #1f2937;
      max-height: 220px;
    }

    /* MODALS */

    .modal.hidden { display: none; }

    .modal {
      position: fixed;
      inset: 0;
      background: rgba(15,23,42,0.8);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 9000;
    }

    .modal-content {
      background: #020617;
      border-radius: 12px;
      padding: 16px 20px;
      border: 1px solid #1f2937;
      min-width: 260px;
      color: var(--text-main);
    }

    .modal-content h3 {
      margin-top: 0;
      margin-bottom: 8px;
      font-size: 16px;
    }

    .modal-content input {
      width: 100%;
    }

    /* BIG CARD OVERLAY (ClubGG-style) */

    #bigCardOverlay {
      position: fixed;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      pointer-events: none;
      opacity: 0;
      transition: opacity 0.15s ease-out;
      z-index: 9999;
    }

    #bigCardOverlay.show {
      opacity: 1;
    }

    #bigCard {
      width: 180px;
      height: 260px;
      border-radius: 16px;
      background: #f9fafb;
      box-shadow: 0 12px 30px rgba(0,0,0,0.5);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      transform: scale(0.2) translateY(40px);
      opacity: 0;
    }

    #bigCard.animate {
      animation: big-card-pop 0.35s ease-out forwards;
    }

    .big-card-rank {
      font-size: 64px;
      font-weight: 700;
      line-height: 1;
    }

    .big-card-suit {
      font-size: 52px;
      margin-top: 8px;
    }

    #bigCard.red .big-card-rank,
    #bigCard.red .big-card-suit {
      color: #dc2626;
    }

    #bigCard.black .big-card-rank,
    #bigCard.black .big-card-suit {
      color: #111827;
    }

    @keyframes big-card-pop {
      0% {
        transform: scale(0.2) translateY(40px);
        opacity: 0;
      }
      60% {
        transform: scale(1.05) translateY(0);
        opacity: 1;
      }
      100% {
        transform: scale(1) translateY(0);
        opacity: 1;
      }
    }
  </style>
</head>
<body>
  <div class="layout">
    <!-- LEFT SIDE: Auth, wallet, clubs, controls (hidden for production) -->
    <div class="panel control-panel" style="display:none !important;">
      <h1>Poker Engine Control</h1>

      <!-- AUTH -->
      <h2>Auth</h2>
      <div class="row">
        <div>
          <span class="label">Email</span><br/>
          <input type="text" id="emailInput" placeholder="you@example.com" />
        </div>
        <div>
          <span class="label">Password</span><br/>
          <input type="password" id="passwordInput" placeholder="password" />
        </div>
      </div>
      <div class="row">
        <button id="registerBtn">Register</button>
        <button id="loginBtn">Login</button>
      </div>
      <div class="row">
        <span class="label">User:</span>
        <span id="currentUserEmail">Not logged in</span>
      </div>

      <!-- WALLET -->
      <h2>Wallet</h2>
      <div class="row wallet-row">
        <div>
          <span class="label">Balance</span>
          <span id="balanceText">0</span>
        </div>
        <button id="topupOpenBtn" disabled>Top up</button>
      </div>

      <!-- CLUBS -->
      <h2>Club</h2>
      <div class="row">
        <div>
          <span class="label">New club name</span><br/>
          <input type="text" id="clubNameInput" placeholder="My Club" />
        </div>
        <button id="createClubBtn" disabled>Create Club</button>
      </div>

      <div class="row">
        <div>
          <span class="label">Join club ID</span><br/>
          <input type="number" id="joinClubIdInput" placeholder="1" />
        </div>
        <button id="joinClubBtn" disabled>Join Club</button>
      </div>

      <div class="row">
        <span class="label">Active club:</span>
        <span id="currentClubId">None</span>
      </div>
      <div class="row">
        <div class="hint">Use the ID of a club you created or joined.</div>
      </div>

      <!-- TABLE SETUP -->
      <h2>Table Setup</h2>
      <div class="row">
        <button id="createTableBtn" disabled>Create Table for Club</button>
        <button id="sitMeBtn" disabled>Sit as Me</button>
      </div>

      <div class="row">
        <span class="label">Join Table ID:</span><br/>
        <input type="number" id="joinTableIdInput" placeholder="1" />
        <button id="joinTableBtn" disabled>Join Table</button>
      </div>

      <div class="row">
        <button id="addAliceBtn" disabled>Add Alice</button>
        <button id="addBobBtn" disabled>Add Bob</button>
        <button id="startHandBtn" disabled title="Hands auto-start when two players are seated">Hands Auto-Start</button>
      </div>

      <!-- BETTING / STREETS -->
      <h2>Streets & Showdown</h2>
      <div class="row">
        <button id="dealFlopBtn" disabled>Deal Flop (manual)</button>
        <button id="dealTurnBtn" disabled>Deal Turn (manual)</button>
        <button id="dealRiverBtn" disabled>Deal River (manual)</button>
        <button id="showdownBtn" disabled>Showdown</button>
      </div>

      <!-- STATE -->
      <h2>State</h2>
      <div class="row">
        <div><span class="label">Table:</span><span id="tableId">None</span></div>
        <div><span class="label">Street:</span><span id="street">-</span></div>
        <div><span class="label">Pot:</span><span id="pot">0</span></div>
        <div><span class="label">Current Bet:</span><span id="currentBet">0</span></div>
        <div><span class="label">Next Seat:</span><span id="nextToAct">-</span></div>
      </div>

      <div class="row">
        <span class="label">Raw JSON</span>
        <pre id="rawState">{}</pre>
      </div>
    </div>

    <!-- RIGHT: Table + bottom action bar -->
    <div class="panel">
      <div class="table-wrapper">
        <div class="felt">
          <div class="felt-content">
            <div class="center-area">
              <div class="board-cards" id="boardCards"></div>
              <div class="pot-info">
                Pot: <span id="potCenter">0</span> | Bet: <span id="betCenter">0</span>
              </div>
              <div class="street-info">
                Street: <span id="streetCenter">-</span>
              </div>
            </div>

            <!-- 9 seat slots -->
            <div class="seat" data-seat="0">
              <div class="seat-inner">
                <div class="seat-main">
                  <div class="seat-avatar">
                    <span class="seat-avatar-initial">?</span>
                  </div>
                  <div class="seat-body">
                    <div class="seat-name-row">
                      <span class="seat-name">Empty</span>
                      <span class="seat-stack">0</span>
                    </div>
                    <div class="seat-meta-row">
                      <span class="seat-status">Waiting for player...</span>
                      <span class="seat-bet"></span>
                    </div>
                  </div>
                </div>
                <div class="seat-cards"></div>
              </div>
            </div>


            <div class="seat" data-seat="1">
              <div class="seat-inner">
                <div class="seat-main">
                  <div class="seat-avatar">
                    <span class="seat-avatar-initial">?</span>
                  </div>
                  <div class="seat-body">
                    <div class="seat-name-row">
                      <span class="seat-name">Empty</span>
                      <span class="seat-stack">0</span>
                    </div>
                    <div class="seat-meta-row">
                      <span class="seat-status">Waiting for player...</span>
                      <span class="seat-bet"></span>
                    </div>
                  </div>
                </div>
                <div class="seat-cards"></div>
              </div>
            </div>


            <div class="seat" data-seat="2">
              <div class="seat-inner">
                <div class="seat-main">
                  <div class="seat-avatar">
                    <span class="seat-avatar-initial">?</span>
                  </div>
                  <div class="seat-body">
                    <div class="seat-name-row">
                      <span class="seat-name">Empty</span>
                      <span class="seat-stack">0</span>
                    </div>
                    <div class="seat-meta-row">
                      <span class="seat-status">Waiting for player...</span>
                      <span class="seat-bet"></span>
                    </div>
                  </div>
                </div>
                <div class="seat-cards"></div>
              </div>
            </div>


            <div class="seat" data-seat="3">
              <div class="seat-inner">
                <div class="seat-main">
                  <div class="seat-avatar">
                    <span class="seat-avatar-initial">?</span>
                  </div>
                  <div class="seat-body">
                    <div class="seat-name-row">
                      <span class="seat-name">Empty</span>
                      <span class="seat-stack">0</span>
                    </div>
                    <div class="seat-meta-row">
                      <span class="seat-status">Waiting for player...</span>
                      <span class="seat-bet"></span>
                    </div>
                  </div>
                </div>
                <div class="seat-cards"></div>
              </div>
            </div>

            <div class="seat" data-seat="4">
              <div class="seat-inner">
                <div class="seat-main">
                  <div class="seat-avatar">
                    <span class="seat-avatar-initial">?</span>
                  </div>
                  <div class="seat-body">
                    <div class="seat-name-row">
                      <span class="seat-name">Empty</span>
                      <span class="seat-stack">0</span>
                    </div>
                    <div class="seat-meta-row">
                      <span class="seat-status">Waiting for player...</span>
                      <span class="seat-bet"></span>
                    </div>
                  </div>
                </div>
                <div class="seat-cards"></div>
              </div>
            </div>


            <div class="seat" data-seat="5">
              <div class="seat-inner">
                <div class="seat-main">
                  <div class="seat-avatar">
                    <span class="seat-avatar-initial">?</span>
                  </div>
                  <div class="seat-body">
                    <div class="seat-name-row">
                      <span class="seat-name">Empty</span>
                      <span class="seat-stack">0</span>
                    </div>
                    <div class="seat-meta-row">
                      <span class="seat-status">Waiting for player...</span>
                      <span class="seat-bet"></span>
                    </div>
                  </div>
                </div>
                <div class="seat-cards"></div>
              </div>
            </div>

            <div class="seat" data-seat="6">
              <div class="seat-inner">
                <div class="seat-main">
                  <div class="seat-avatar">
                    <span class="seat-avatar-initial">?</span>
                  </div>
                  <div class="seat-body">
                    <div class="seat-name-row">
                      <span class="seat-name">Empty</span>
                      <span class="seat-stack">0</span>
                    </div>
                    <div class="seat-meta-row">
                      <span class="seat-status">Waiting for player...</span>
                      <span class="seat-bet"></span>
                    </div>
                  </div>
                </div>
                <div class="seat-cards"></div>
              </div>
            </div>

            <div class="seat" data-seat="7">
              <div class="seat-inner">
                <div class="seat-main">
                  <div class="seat-avatar">
                    <span class="seat-avatar-initial">?</span>
                  </div>
                  <div class="seat-body">
                    <div class="seat-name-row">
                      <span class="seat-name">Empty</span>
                      <span class="seat-stack">0</span>
                    </div>
                    <div class="seat-meta-row">
                      <span class="seat-status">Waiting for player...</span>
                      <span class="seat-bet"></span>
                    </div>
                  </div>
                </div>
                <div class="seat-cards"></div>
              </div>
            </div>

            <div class="seat" data-seat="8">
              <div class="seat-inner">
                <div class="seat-main">
                  <div class="seat-avatar">
                    <span class="seat-avatar-initial">?</span>
                  </div>
                  <div class="seat-body">
                    <div class="seat-name-row">
                      <span class="seat-name">Empty</span>
                      <span class="seat-stack">0</span>
                    </div>
                    <div class="seat-meta-row">
                      <span class="seat-status">Waiting for player...</span>
                      <span class="seat-bet"></span>
                    </div>
                  </div>
                </div>
                <div class="seat-cards"></div>
              </div>
            </div>
          </div>

        </div>
        <div class="felt-surface"></div>
      </div>

      <!-- Action dock -->
      <div class="action-dock">
        <div class="action-left">
          <button id="foldMainBtn" class="btn-danger" disabled>Fold</button>
        </div>

        <div class="action-middle">
          <div>
            <div class="bottom-label">Acting Player</div>
            <div id="actingPlayerLabel">None</div>
          </div>
          <div class="action-middle-main">
            <button id="callMainBtn" disabled>Call / Check</button>
            <span id="callAmountLabel">0</span>
          </div>
        </div>

        <div class="action-right">
          <div>
            <div class="bottom-label">Raise</div>
            <div style="display:flex;gap:4px;flex-wrap:wrap;align-items:center;">
              <input type="number" id="raiseCustomInput" placeholder="Amt" />
              <button id="raiseCustomBtn" disabled>Raise</button>
              <button id="raise30Btn" disabled>30%</button>
              <button id="raise50Btn" disabled>50%</button>
              <button id="raise100Btn" disabled>100%</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="legal-footer">
    <a href="legal.html" target="_blank" rel="noopener">Play-money poker disclaimer</a>
    &nbsp;•&nbsp;
    <a href="terms.html" target="_blank" rel="noopener">Terms of Service</a>
  </div>

  <!-- Top up modal -->
  <div id="topupModal" class="modal hidden">
    <div class="modal-content">
      <h3>Top up balance</h3>
      <input type="number" id="topupAmount" min="1" step="1" value="1000" />
      <div style="margin-top:8px;display:flex;justify-content:flex-end;gap:8px;">
        <button id="topupCancelBtn" class="btn-danger">Cancel</button>
        <button id="topupConfirmBtn">Confirm</button>
      </div>
    </div>
  </div>

  <!-- Big card overlay -->
  <div id="bigCardOverlay">
    <div id="bigCard">
      <div id="bigCardRank" class="big-card-rank"></div>
      <div id="bigCardSuit" class="big-card-suit"></div>
    </div>
  </div>

  <script>
    const API_BASE = "";
    const AUTH_STORAGE_KEY = "pokerAuth";
    let tableId = null;
    let lastState = null;
    let tableSocket = null;
    let accessToken = null;
    let currentUserEmail = null;
    let currentClubId = null;
    let actingPlayer = null; // current acting player object from state
    let bigBlind = 2; // default; update if you change createTable values
    let currentUserBalance = 0;

    const DEFAULT_SEAT_RADIUS = { x: 42, y: 34 };
    const TABLE_ASPECT_RATIO = 9 / 16;
    const MIN_TABLE_HEIGHT = 320;

    const tableWrapper = document.querySelector(".table-wrapper");

    function fitTableToViewport() {
      if (!tableWrapper) return;

      const actionDock = document.querySelector(".action-dock");
      const layoutVerticalPadding = 24; // padding on the main layout container
      const actionHeight = actionDock?.offsetHeight ?? 0;

      const availableHeight = window.innerHeight - layoutVerticalPadding - actionHeight - 24;
      const availableWidth = tableWrapper.parentElement?.clientWidth || window.innerWidth - layoutVerticalPadding;
      const idealHeight = Math.min(availableHeight, availableWidth * TABLE_ASPECT_RATIO);
      const clampedHeight = Math.max(MIN_TABLE_HEIGHT, idealHeight);

      tableWrapper.style.height = `${clampedHeight}px`;
    }

    function generateSeatPositions(totalSeats, viewerSeat = Math.floor(totalSeats / 2), radius = DEFAULT_SEAT_RADIUS) {
      const seatCount = Math.max(2, totalSeats);
      const anchorSeat = Math.min(Math.max(viewerSeat, 0), seatCount - 1);
      const angleStep = 360 / seatCount;
      const angleOffset = 90 - angleStep * anchorSeat; // place anchor seat at bottom center

      return Array.from({ length: seatCount }, (_, idx) => {
        const angleRad = ((angleOffset + angleStep * idx) * Math.PI) / 180;
        return {
          top: `${50 + radius.y * Math.sin(angleRad)}%`,
          left: `${50 + radius.x * Math.cos(angleRad)}%`,
        };
      });
    }

    // DOM elements
    const emailInput = document.getElementById("emailInput");
    const passwordInput = document.getElementById("passwordInput");
    const registerBtn = document.getElementById("registerBtn");
    const loginBtn = document.getElementById("loginBtn");
    const currentUserEmailSpan = document.getElementById("currentUserEmail");

    const balanceTextSpan = document.getElementById("balanceText");
    const topupOpenBtn = document.getElementById("topupOpenBtn");
    const topupModal = document.getElementById("topupModal");
    const topupAmountInput = document.getElementById("topupAmount");
    const topupConfirmBtn = document.getElementById("topupConfirmBtn");
    const topupCancelBtn = document.getElementById("topupCancelBtn");

    const clubNameInput = document.getElementById("clubNameInput");
    const createClubBtn = document.getElementById("createClubBtn");
    const joinClubIdInput = document.getElementById("joinClubIdInput");
    const joinClubBtn = document.getElementById("joinClubBtn");
    const currentClubIdSpan = document.getElementById("currentClubId");

    const createTableBtn = document.getElementById("createTableBtn");
    const sitMeBtn = document.getElementById("sitMeBtn");
    const joinTableIdInput = document.getElementById("joinTableIdInput");
    const joinTableBtn = document.getElementById("joinTableBtn");

    const addAliceBtn = document.getElementById("addAliceBtn");
    const addBobBtn = document.getElementById("addBobBtn");
    const startHandBtn = document.getElementById("startHandBtn");
    startHandBtn.title = "Hands start automatically once two players are seated";

    const dealFlopBtn = document.getElementById("dealFlopBtn");
    const dealTurnBtn = document.getElementById("dealTurnBtn");
    const dealRiverBtn = document.getElementById("dealRiverBtn");
    const showdownBtn = document.getElementById("showdownBtn");

    const tableIdSpan = document.getElementById("tableId");
    const streetSpan = document.getElementById("street");
    const potSpan = document.getElementById("pot");
    const currentBetSpan = document.getElementById("currentBet");
    const nextToActSpan = document.getElementById("nextToAct");
    const rawStatePre = document.getElementById("rawState");

    const seatElements = Array.from(document.querySelectorAll(".seat"));
    const defaultSeatPositions = generateSeatPositions(seatElements.length, 5);

    function applySeatPositions(positions = defaultSeatPositions) {
      seatElements.forEach((seatEl, idx) => {
        const pos = positions[idx] || positions[positions.length - 1] || { top: "50%", left: "50%" };
        seatEl.style.top = pos.top;
        seatEl.style.left = pos.left;
      });
    }

    applySeatPositions();
    fitTableToViewport();
    window.addEventListener("resize", fitTableToViewport);

    const boardCardsSpan = document.getElementById("boardCards");
    const potCenterSpan = document.getElementById("potCenter");
    const betCenterSpan = document.getElementById("betCenter");
    const streetCenterSpan = document.getElementById("streetCenter");

    // Action dock elements
    const foldMainBtn = document.getElementById("foldMainBtn");
    const callMainBtn = document.getElementById("callMainBtn");
    const callAmountLabel = document.getElementById("callAmountLabel");
    const actingPlayerLabel = document.getElementById("actingPlayerLabel");

    const raiseCustomInput = document.getElementById("raiseCustomInput");
    const raiseCustomBtn = document.getElementById("raiseCustomBtn");
    const raise30Btn = document.getElementById("raise30Btn");
    const raise50Btn = document.getElementById("raise50Btn");
    const raise100Btn = document.getElementById("raise100Btn");

    // Big card popup elements
    const bigCardOverlay = document.getElementById("bigCardOverlay");
    const bigCard = document.getElementById("bigCard");
    const bigCardRank = document.getElementById("bigCardRank");
    const bigCardSuit = document.getElementById("bigCardSuit");

    function getCardImageFilename(card) {
      if (!card || card.length < 2) return null;

      const rankChar = card[0].toUpperCase();
      const suitChar = card[1].toLowerCase();

      const rankMap = {
        "A": "ace",
        "K": "king",
        "Q": "queen",
        "J": "jack",
        "T": "ten",
        "9": "nine",
        "8": "eight",
        "7": "seven",
        "6": "six",
        "5": "five",
        "4": "four",
        "3": "three",
        "2": "two",
      };

      const suitMap = {
        "c": "clubs",
        "d": "diamonds",
        "h": "hearts",
        "s": "spades",
      };

      const rankName = rankMap[rankChar];
      const suitName = suitMap[suitChar];

      if (!rankName || !suitName) return null;

      return `${rankName}_of_${suitName}.png`; // e.g. "queen_of_clubs.png"
    }

    function getCardImageSrc(card) {
      const filename = getCardImageFilename(card);
      if (!filename) return null;
      return `/static/cards/${filename}`;
    }

    function restoreAuthFromStorage() {
      try {
        const raw = localStorage.getItem(AUTH_STORAGE_KEY);
        if (!raw) return;
        const parsed = JSON.parse(raw);
        if (!parsed.token || !parsed.email) return;
        accessToken = parsed.token;
        currentUserEmail = parsed.email;
        if (currentUserEmailSpan) currentUserEmailSpan.textContent = parsed.email;
        if (emailInput) emailInput.value = parsed.email;
        createClubBtn.disabled = false;
        joinClubBtn.disabled = false;
        createTableBtn.disabled = false;
        joinTableBtn.disabled = false;
        fetchMe();
      } catch (err) {
        console.warn("Failed to restore auth", err);
      }
    }

    async function api(path, options = {}) {
      const headers = {
        "Content-Type": "application/json",
        ...(options.headers || {}),
      };
      if (accessToken) {
        headers["Authorization"] = `Bearer ${accessToken}`;
      }

      const res = await fetch(API_BASE + path, {
        ...options,
        headers,
      });
      if (!res.ok) {
        const text = await res.text();
        throw new Error(`Error ${res.status}: ${text}`);
      }
      return res.json();
    }

    function clearSeats() {
  const seats = document.querySelectorAll(".seat");
  seats.forEach(seat => {
    seat.classList.add("empty");
    seat.classList.remove("highlight");
    const nameEl = seat.querySelector(".seat-name");
    const stackEl = seat.querySelector(".seat-stack");
    const statusEl = seat.querySelector(".seat-status");
    const betEl = seat.querySelector(".seat-bet");
    const avatarInitialEl = seat.querySelector(".seat-avatar-initial");
    const cardsEl = seat.querySelector(".seat-cards");

    if (nameEl) nameEl.textContent = "Empty";
    if (stackEl) stackEl.textContent = "";
    if (statusEl) statusEl.textContent = "Waiting for player...";
    if (betEl) betEl.textContent = "";
    if (avatarInitialEl) avatarInitialEl.textContent = "?";
    if (cardsEl) cardsEl.innerHTML = "";
  });
}


    function updateBalanceUI(amount) {
      currentUserBalance = amount || 0;
      if (balanceTextSpan) {
        balanceTextSpan.textContent = currentUserBalance;
      }
    }

    async function fetchMe() {
      try {
        const me = await api(`/me?email=${encodeURIComponent(currentUserEmail)}`, {
          method: "GET",
        });
        // assumes backend returns { email, balance, current_club_id }
        if (me.email) {
          currentUserEmailSpan.textContent = me.email;
        }
        if (typeof me.balance === "number") {
          updateBalanceUI(me.balance);
        }
        currentClubId = me.current_club_id || null;
        currentClubIdSpan.textContent = currentClubId ? String(currentClubId) : "None";
        if (topupOpenBtn) topupOpenBtn.disabled = false;
      } catch (e) {
        console.warn("Failed to load /me:", e);
      }
    }

    async function sendAction(playerId, action, amount = null) {
      if (!tableId || !playerId) return;
      try {
        await api(`/tables/${tableId}/action`, {
          method: "POST",
          body: JSON.stringify({
            player_id: playerId,
            action: action,
            amount: amount,
          }),
        });
      } catch (e) {
        alert(e.message);
      }
    }

    function showBigCard(card) {
      if (!bigCardOverlay || !bigCard || !card) return;

      const rank = card[0];
      const suitChar = card[1] ? card[1].toLowerCase() : null;
      const suitMap = { s: "♠", h: "♥", d: "♦", c: "♣" };

      bigCardRank.textContent = rank ? rank.toUpperCase() : "?";
      bigCardSuit.textContent = suitMap[suitChar] || "?";

      bigCard.classList.remove("red", "black");
      if (suitChar === "h" || suitChar === "d") {
        bigCard.classList.add("red");
      } else {
        bigCard.classList.add("black");
      }

      bigCardOverlay.classList.add("show");
      bigCard.classList.remove("animate");
      void bigCard.offsetWidth; // restart animation
      bigCard.classList.add("animate");

      setTimeout(() => {
        bigCardOverlay.classList.remove("show");
      }, 600);
    }

    function updateActionDock(state) {
      const pot = state.pot || 0;
      const currentBet = state.current_bet || 0;
      actingPlayer = null;

      if (state.next_to_act_seat === null || state.next_to_act_seat === undefined) {
        actingPlayerLabel.textContent = "None";
        callMainBtn.disabled = true;
        foldMainBtn.disabled = true;
        raiseCustomBtn.disabled = true;
        raise30Btn.disabled = true;
        raise50Btn.disabled = true;
        raise100Btn.disabled = true;
        callAmountLabel.textContent = "0";
        return;
      }

      actingPlayer = state.players.find(p => p.seat === state.next_to_act_seat);
      if (!actingPlayer) {
        actingPlayerLabel.textContent = "None";
        callMainBtn.disabled = true;
        foldMainBtn.disabled = true;
        raiseCustomBtn.disabled = true;
        raise30Btn.disabled = true;
        raise50Btn.disabled = true;
        raise100Btn.disabled = true;
        callAmountLabel.textContent = "0";
        return;
      }

      actingPlayerLabel.textContent = `${actingPlayer.name} (seat ${actingPlayer.seat})`;

      const toCall = Math.max(0, currentBet - actingPlayer.committed);
      const viewerSeat = getViewerSeat(state);
      const isViewerTurn = viewerSeat != null && actingPlayer.user_id === currentUserId;

      callAmountLabel.textContent = toCall > 0 ? toCall.toString() : "0 (check)";
      callMainBtn.disabled = !isViewerTurn;
      foldMainBtn.disabled = !isViewerTurn;

      const canRaise = isViewerTurn && !actingPlayer.all_in && !actingPlayer.has_folded;
      raiseCustomBtn.disabled = !canRaise;
      raise30Btn.disabled = !canRaise || pot <= 0;
      raise50Btn.disabled = !canRaise || pot <= 0;
      raise100Btn.disabled = !canRaise || pot <= 0;

      callMainBtn.onclick = () => sendAction(actingPlayer.id, "call");
      foldMainBtn.onclick = () => sendAction(actingPlayer.id, "fold");

      raiseCustomBtn.onclick = () => {
        const amt = Number(raiseCustomInput.value);
        if (!amt || amt <= currentBet) {
          alert("Raise must be > current bet");
          return;
        }
        sendAction(actingPlayer.id, "raise_to", amt);
      };

      const makePctHandler = fraction => () => {
        if (pot <= 0) {
          alert("Pot is 0; enter a custom raise amount");
          return;
        }
        let amt = Math.floor(pot * fraction);
        if (amt <= currentBet) {
          amt = currentBet + 1;
        }
        sendAction(actingPlayer.id, "raise_to", amt);
      };

      raise30Btn.onclick = makePctHandler(0.3);
      raise50Btn.onclick = makePctHandler(0.5);
      raise100Btn.onclick = makePctHandler(1.0);
    }

    function renderState(state) {
      const prevState = lastState;
      lastState = state;

      tableIdSpan.textContent = state.id;
      streetSpan.textContent = state.street;
      potSpan.textContent = state.pot;
      currentBetSpan.textContent = state.current_bet;
      nextToActSpan.textContent = state.next_to_act_seat ?? "-";

      potCenterSpan.textContent = state.pot;
      betCenterSpan.textContent = state.current_bet;
      streetCenterSpan.textContent = state.street;

      // ---- BOARD CARDS ----
      const prevBoardLen = prevState ? prevState.board.length : 0;
      boardCardsSpan.innerHTML = "";
      state.board.forEach((c, idx) => {
      const span = document.createElement("span");
      span.className = "card";
      if (idx >= prevBoardLen) {
        span.classList.add("dealt");
        showBigCard(c);
      }

      const imgSrc = getCardImageSrc(c);
      if (imgSrc) {
        span.innerHTML = `<img class="card-img" src="${imgSrc}" alt="${c}">`;
      } else {
        // fallback to text if mapping fails
        span.textContent = c;
      }

      boardCardsSpan.appendChild(span);
    });


      // ---- SEATS & HOLE CARDS ----
      clearSeats();
      state.players.forEach(p => {
        const seatDiv = document.querySelector(`.seat[data-seat="${p.seat}"]`);
        if (!seatDiv) return;

        seatDiv.classList.remove("empty");

        const nameEl = seatDiv.querySelector(".seat-name");
        const stackEl = seatDiv.querySelector(".seat-stack");
        const statusEl = seatDiv.querySelector(".seat-status");
        const betEl = seatDiv.querySelector(".seat-bet");
        const cardsEl = seatDiv.querySelector(".seat-cards");
        const avatarInitialEl = seatDiv.querySelector(".seat-avatar-initial");

        // Name + stack
        nameEl.textContent = p.name || `Seat ${p.seat}`;
        stackEl.textContent = p.stack != null ? p.stack.toString() : "0";

        // Avatar initial (first letter of name/email)
        if (avatarInitialEl) {
          const initialSource = p.name || p.email || "?";
          avatarInitialEl.textContent = initialSource.trim().charAt(0).toUpperCase() || "?";
        }

        // Status (clean, no true/false spam)
        if (p.has_folded) {
          statusEl.textContent = "Folded";
        } else if (p.all_in) {
          statusEl.textContent = "All-in";
        } else if (!p.in_hand) {
          statusEl.textContent = "Sitting out";
        } else {
          statusEl.textContent = "In hand";
        }

        // Bet / committed chips
        if (betEl) {
          betEl.textContent = p.committed > 0 ? `Bet: ${p.committed}` : "";
        }

        // Hole cards (card images – keep your existing image logic)
        cardsEl.innerHTML = "";
        p.hole_cards.forEach((c, idx) => {
          const span = document.createElement("span");
          span.className = "seat-card";
          if (idx >= prevHoleLen) {
            span.classList.add("dealt");
            showBigCard(c);
          }

          const imgSrc = getCardImageSrc(c);  // your helper
          if (imgSrc) {
            span.innerHTML = `<img class="card-img" src="${imgSrc}" alt="${c}">`;
          } else {
            span.textContent = c;
          }
          cardsEl.appendChild(span);
        });

        if (state.next_to_act_seat === p.seat) {
          seatDiv.classList.add("highlight");
        }
      });


      rawStatePre.textContent = JSON.stringify(state, null, 2);

      dealFlopBtn.disabled = state.street !== "preflop";
      dealTurnBtn.disabled = state.street !== "flop";
      dealRiverBtn.disabled = state.street !== "turn";
      showdownBtn.disabled = state.street !== "river";

      updateActionDock(state);
    }

    function connectWebSocket() {
      if (!tableId) return;

      if (tableSocket) {
        tableSocket.close();
        tableSocket = null;
      }

      const protocol = window.location.protocol === "https:" ? "wss" : "ws";
      const tokenParam = accessToken ? `?token=${encodeURIComponent(accessToken)}` : "";
      const url = `${protocol}://${window.location.host}/ws/tables/${tableId}${tokenParam}`;
      tableSocket = new WebSocket(url);

      tableSocket.onmessage = (event) => {
        try {
          const state = JSON.parse(event.data);
          renderState(state);
        } catch (e) {
          console.error("Bad WS message", e);
        }
      };

      tableSocket.onclose = () => {
        console.log("WebSocket closed");
      };

      tableSocket.onerror = (err) => {
        console.error("WebSocket error", err);
      };
    }

    // -------- Auth actions --------

    restoreAuthFromStorage();

    registerBtn.onclick = async () => {
      const email = emailInput.value.trim();
      const password = passwordInput.value;
      if (!email || !password) {
        alert("Enter email and password");
        return;
      }
      try {
        const res = await fetch("/auth/register", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ email, password }),
        });
        if (!res.ok) {
          const text = await res.text();
          throw new Error(`Error ${res.status}: ${text}`);
        }
        await res.json();
        alert("Registered. Now login.");
      } catch (e) {
        alert(e.message);
      }
    };

    loginBtn.onclick = async () => {
      const email = emailInput.value.trim();
      const password = passwordInput.value;
      if (!email || !password) {
        alert("Enter email and password");
        return;
      }
      try {
        const body = new URLSearchParams();
        body.append("username", email);
        body.append("password", password);

        const res = await fetch("/auth/token", {
          method: "POST",
          headers: { "Content-Type": "application/x-www-form-urlencoded" },
          body,
        });
        if (!res.ok) {
          const text = await res.text();
          throw new Error(`Error ${res.status}: ${text}`);
        }
        const data = await res.json();
        accessToken = data.access_token;
        currentUserEmail = email;
        currentUserEmailSpan.textContent = email;

        createClubBtn.disabled = false;
        joinClubBtn.disabled = false;
        createTableBtn.disabled = false;
        joinTableBtn.disabled = false;
        if (topupOpenBtn) topupOpenBtn.disabled = false;

        // Load persisted balance + club
        fetchMe();

        alert("Logged in!");
      } catch (e) {
        alert(e.message);
      }
    };

    // -------- Wallet actions --------

    if (topupOpenBtn) {
      topupOpenBtn.onclick = () => {
        if (!accessToken) {
          alert("Login first");
          return;
        }
        topupModal.classList.remove("hidden");
      };
    }

    if (topupCancelBtn) {
      topupCancelBtn.onclick = () => {
        topupModal.classList.add("hidden");
      };
    }

    if (topupConfirmBtn) {
      topupConfirmBtn.onclick = async () => {
        const amount = Number(topupAmountInput.value);
        if (!amount || amount <= 0) {
          alert("Enter a positive amount");
          return;
        }
        try {
          const me = await api(`/wallet/topup?email=${encodeURIComponent(currentUserEmail)}`, {
            method: "POST",
            body: JSON.stringify({ amount }),
        });
          if (typeof me.balance === "number") {
            updateBalanceUI(me.balance);
          }
          topupModal.classList.add("hidden");
        } catch (e) {
          alert(e.message);
        }
      };
    }

    // -------- Club actions --------

    createClubBtn.onclick = async () => {
      if (!accessToken) {
        alert("Login first");
        return;
      }
      const name = clubNameInput.value.trim() || "My Club";

      try {
        const club = await api("/clubs/", {
          method: "POST",
          body: JSON.stringify({ name }),
        });
        currentClubId = club.id;
        currentClubIdSpan.textContent = String(currentClubId);
        alert(`Created club ID ${currentClubId}`);
        // Tell backend to remember this as my active club
        await api(`/me/club?email=${encodeURIComponent(currentUserEmail)}`, {
          method: "POST",
          body: JSON.stringify({ club_id: club.id }),
        });

   

        // If your backend sets current_club_id on /clubs/ create, /me will reflect it next time
      } catch (e) {
        alert(e.message);
      }
    };

    joinClubBtn.onclick = async () => {
      if (!accessToken) {
        alert("Login first");
        return;
      }
        const cid = Number(joinClubIdInput.value);
        if (!cid) {
          alert("Enter a club ID");
          return;
        }
        try {
          const club = await api(`/clubs/${cid}/join`, {
            method: "POST",
          });
          try {
            // Tell backend to remember this as my active club
            await api(`/me/club?email=${encodeURIComponent(currentUserEmail)}`, {
              method: "POST",
              body: JSON.stringify({ club_id: club.id }),
            });
            currentClubId = club.id;
            currentClubIdSpan.textContent = String(currentClubId);
            alert(`Joined club ID ${currentClubId}`);
          } catch (err) {
            alert("Request sent. The club owner must approve you before you can access this club.");
          }



          // For "remember my club", you can also make this update current_club_id server-side
        } catch (e) {
        alert(e.message);
      }
    };

    // -------- Table actions --------

    createTableBtn.onclick = async () => {
      if (!accessToken) {
        alert("Login first");
        return;
      }
      if (!currentClubId) {
        alert("Create or join a club first");
        return;
      }
      try {
        const data = await api("/tables/", {
          method: "POST",
          body: JSON.stringify({
            club_id: currentClubId,
            max_seats: 6,
            small_blind: 1,
            big_blind: 2,
          }),
        });
        tableId = data.table_id;
        tableIdSpan.textContent = tableId;

        bigBlind = 2;

        sitMeBtn.disabled = false;
        addAliceBtn.disabled = false;
        addBobBtn.disabled = false;
        startHandBtn.disabled = true;

        connectWebSocket();
        alert(`Created table ID ${tableId} for club ${currentClubId}`);
      } catch (e) {
        alert(e.message);
      }
    };

    async function joinTableById(tid) {
      if (!accessToken) {
        alert("Login first");
        return;
      }
      if (!tid) {
        alert("Enter a table ID");
        return;
      }
      try {
        const state = await api(`/tables/${tid}`, { method: "GET" });
        tableId = tid;
        tableIdSpan.textContent = String(tid);

        sitMeBtn.disabled = false;
        addAliceBtn.disabled = true;
        addBobBtn.disabled = true;
        startHandBtn.disabled = true;

        connectWebSocket();
        renderState(state);
        alert(`Joined table ${tid}`);
      } catch (e) {
        alert(e.message);
      }
    }

    joinTableBtn.onclick = async () => {
      const tid = Number(joinTableIdInput.value);
      joinTableById(tid);
    };

    sitMeBtn.onclick = async () => {
      if (!accessToken) {
        alert("Login first");
        return;
      }
      if (!tableId) {
        alert("Create or join a table first");
        return;
      }
      try {
        await api(`/tables/${tableId}/sit_me`, {
          method: "POST",
        });
      } catch (e) {
        alert(e.message);
      }
    };

    addAliceBtn.onclick = async () => {
      if (!tableId) return;
      try {
        await api(`/tables/${tableId}/players`, {
          method: "POST",
          body: JSON.stringify({ name: "Alice", starting_stack: 100 }),
        });
      } catch (e) {
        alert(e.message);
      }
    };

    addBobBtn.onclick = async () => {
      if (!tableId) return;
      try {
        await api(`/tables/${tableId}/players`, {
          method: "POST",
          body: JSON.stringify({ name: "Bob", starting_stack: 100 }),
        });
      } catch (e) {
        alert(e.message);
      }
    };

    startHandBtn.onclick = () => {
      alert("Hands now start automatically when two players are seated.");
    };

    dealFlopBtn.onclick = async () => {
      if (!tableId) return;
      try {
        await api(`/tables/${tableId}/deal_flop`, { method: "POST" });
      } catch (e) {
        alert(e.message);
      }
    };

    dealTurnBtn.onclick = async () => {
      if (!tableId) return;
      try {
        await api(`/tables/${tableId}/deal_turn`, { method: "POST" });
      } catch (e) {
        alert(e.message);
      }
    };

    dealRiverBtn.onclick = async () => {
      if (!tableId) return;
      try {
        await api(`/tables/${tableId}/deal_river`, { method: "POST" });
      } catch (e) {
        alert(e.message);
      }
    };

    showdownBtn.onclick = async () => {
      if (!tableId) return;
      try {
        const result = await api(`/tables/${tableId}/showdown`, { method: "POST" });
        alert(
          "Winners: " +
            result.winners.map(w => w.name + " (stack " + w.stack + ")").join(", ")
        );
      } catch (e) {
        alert(e.message);
      }
    };

    const params = new URLSearchParams(window.location.search);
    const queryTableId = Number(params.get("tableId"));
    if (queryTableId) {
      joinTableIdInput.value = String(queryTableId);
      joinTableById(queryTableId);
    }
  </script>
</body>
</html>
